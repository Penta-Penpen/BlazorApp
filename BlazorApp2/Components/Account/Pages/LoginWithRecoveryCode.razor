@page "/Account/LoginWithRecoveryCode"
@rendermode InteractiveServer

@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Identity
@using BlazorApp2.Data

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject NavigationManager NavigationManager
@inject ILogger<LoginWithRecoveryCode> Logger

<PageTitle>Recovery code verification</PageTitle>

<h1>Recovery code verification</h1>
<hr />
<StatusMessage Message="@message" />
<p>
    You have requested to log in with a recovery code. This login will not be remembered until you provide
    an authenticator app code at log in or disable 2FA and log in again.
</p>
<div class="row">
    <div class="col-md-4">
        <form action="/Account/PerformLoginWithRecoveryCode" method="post">
            <div class="form-floating mb-3">
                <input name="RecoveryCode" class="form-control" autocomplete="off" aria-required="true" placeholder="RecoveryCode" required />
                <label for="recovery-code" class="form-label">Recovery Code</label>
            </div>
            <input type="hidden" name="ReturnUrl" value="@ReturnUrl" />
            <div>
                <button type="submit" class="w-100 btn btn-lg btn-primary">Log in</button>
            </div>
        </form>
    </div>
</div>

@code {
    private string? message;
    //private ApplicationUser? user = default!;

    [SupplyParameterFromQuery(Name = "error")]
    private string? Error { get; set; }

    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; set; }

    protected override void OnInitialized()
    {
        if (!string.IsNullOrEmpty(Error))
        {
            message = $"Error: {Error}";
        }

        // Ensure the user has gone through the username & password screen first
        //user = await SignInManager.GetTwoFactorAuthenticationUserAsync();
        //
        //if (user is null)
        //{
        //    throw new InvalidOperationException("Unable to load two-factor authentication user.");
        //}
    }
}
